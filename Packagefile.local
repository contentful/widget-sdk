#!/bin/bash

set -x
set -e
umask 0022

package_name="cf-user-interface"
version="0.$(date '+%s')-g$(git log -1 --pretty=format:%h)"

BUILD_ROOT=$(mktemp -d -t user-interface.XXXX.$version);

PACKAGE_ROOT=$BUILD_ROOT/opt/contentful/$package_name
mkdir -p $PACKAGE_ROOT/bin

cp -a build $PACKAGE_ROOT
cp -p bin/process_hosts $PACKAGE_ROOT/bin

fpm -t deb -s dir \
  -n $package_name \
  --version $version \
  --exclude '**/.nfs*' \
  -C $BUILD_ROOT \
  opt
