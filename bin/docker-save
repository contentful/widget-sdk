#!/bin/bash

set -ex

base="contentful/user-interface-base:1"

# We remove the old cached images that have not been rebuild
docker rmi $(docker images -q -f dangling=true) || true

images=$(
  docker images \
    -aq \
    -f "before=contentful/user-interface" \
    -f "since=$base" \
    | tr '\n' ' '
  )

mkdir -p cache
docker save --output cache/images.tar "$base" $images
