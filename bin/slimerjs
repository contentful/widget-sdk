#!/bin/bash
#
# This file exists because of a weird bug in SlimerJS
#
# Running the karama launcher with SlimerJS and without redirecting
# stdout will not allow the process to exit.
#
# We also need to provide output for the `bin/install_slimerjs` script.
#

export SLIMERJSLAUNCHER=$(which firefox 2>/dev/null)
if [[ ! -x "${SLIMERJSLAUNCHER}" ]]; then
  echo 'Cannot find "firefox" in PATH' 1>&2
  exit 1
fi

SLIMERJS_BIN="$(dirname $0)/../vendor/slimerjs/slimerjs-0.10.0/slimerjs"

if [[ ! -x "${SLIMERJS_BIN}" ]]; then
  echo "${SLIMERJS_BIN} is not executable"
  echo "Please run bin/install_slimerjs"
  exit 1
fi

if [[ "$@" == "--version" ]]; then
  exec "${SLIMERJS_BIN}" --version
else
  exec "${SLIMERJS_BIN}" "$@" >/dev/null
fi
