#!/bin/bash
#
# This script installs SlimerJS and patches it so that it can be used
# with all Firefox versions.
#

set -e

SLIMER_VERSION="0.10.3"
SLIMER_DIST="slimerjs-${SLIMER_VERSION}"
SLIMER_ARCHIVE="${SLIMER_DIST}.zip"
DOWNLOAD_URL="https://download.slimerjs.org/releases/${SLIMER_VERSION}/${SLIMER_ARCHIVE}"

rm -rf vendor/slimerjs/${SLIMER_DIST} || true

echo "Downloading SlimerJS v${SLIMER_VERSION}..."
rm -rf "${SLIMER_DIST}" "${SLIMER_ARCHIVE}"
curl -O --progress-bar "${DOWNLOAD_URL}"
unzip -o -qq "${SLIMER_ARCHIVE}" -d vendor/slimerjs
rm "${SLIMER_ARCHIVE}"

# Patch SlimerJS to work with Firefox versions newer then 52
sed -i.old 's/^MaxVersion=.*/MaxVersion=*/' "vendor/slimerjs/${SLIMER_DIST}/application.ini"

echo "SlimerJS installed into vendor/slimerjs/${SLIMER_DIST}"
