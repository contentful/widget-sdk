include ../../components/shared/table_pattern.mixin.jade

header.workbench-header
  cf-breadcrumbs
  cf-icon.workbench-header__icon(name="page-settings", scale="0.75")
  h1.workbench-header__title Webhook: {{ context.title }}

  .workbench-header__actions(ui-tabpanel="settings")
    button.btn-secondary-action(ui-command="openRemovalDialog")
      | Remove
    button.btn-primary-action(ui-command="save")
      | Save

  .workbench-header__actions(ui-tabpanel="activity")
    button.btn-secondary-action(ui-command="refreshLogs")
      | Refresh logs

cf-loader(watch-state-change="true")

.workbench-nav(ng-hide="context.isNew")
  ul.workbench-nav__tabs
    li(ui-tab="settings") Webhook settings
    li(ui-tab="activity") Activity log

.workbench-main(ui-tabpanel="settings")
  .workbench-main__content
    react-component(name="app/Webhooks/WebhookForm" props="props")
  .workbench-main__sidebar
    react-component(name="app/Webhooks/WebhookSidebar")

.workbench-main(ui-tabpanel="activity")
  .workbench-main__content
    .table
      .table__head
        table
          thead
            tr
              th(aria-label="cell-time") Webhook called at
              th(aria-label="cell-result").x--large-cell Call result
              th(aria-label="cell-actions") Actions
      .table__body
        table
          tbody
            tr(
              ng-show="activity.visible && !activity.loading"
              ng-repeat="log in activity.visible track by log.sys.id"
              ng-init="entityNavState = '^.detail.call({ callId: log.sys.id })'"
              ui-sref="{{entityNavState}}")
              +td(aria-label="cell-time"
                ui-sref="{{entityNavState}}")
                | {{ log.requestAt }}
              +td.x--large-cell(aria-label="cell-result"
                ui-sref="{{entityNavState}}")
                cf-webhook-call-status(call="log")
              +td(aria-label="cell-actions"
                ui-sref="{{entityNavState}}")
                span.text-link--standard View details
            tr(ng-show="activity.visible.length < 1")
              td(colspan="3")
                | No webhook calls yet!
            tr(ng-show="activity.loading")
              td(colspan="3")
                | Loading logsâ€¦

    .webhook-calls__paginator(ng-show="!activity.loading && activity.pages.length > 1")
      a.webhook-calls__paginator-item(
        ng-show="activity.page > 0"
        href="" ng-click="activity.page = activity.page-1")
        | &laquo;
      a.webhook-calls__paginator-item(
        ng-class="{'x--active': activity.page === page}"
        ng-repeat="page in activity.pages track by page"
        href="" ng-click="activity.page = page")
        | {{ page+1 }}
      a.webhook-calls__paginator-item(
        ng-show="activity.page < activity.pages.length-1"
        href="" ng-click="activity.page = activity.page+1")
        | &raquo;
