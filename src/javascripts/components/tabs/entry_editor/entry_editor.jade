.tab-header
  .tab-header__title
    cf-icon(name="page-entries")
    h1(title="{{headline()}}")
      | {{headline()}}
      a(cf-knowledge-base-icon
        tooltip="Learn more about Entries in the Knowledge Base Pages"
        analytics-event="entries"
        href="https://contentful.zendesk.com/hc/en-us/articles/200513208-What-is-an-Entry-")

  .tab-header__actions
    button.cfnext-btn-secondary-action(type="button"
            ng-click="preferences.toggleAuxPanel()"
            ng-class="{active: preferences.showAuxPanel}"
            tooltip="Toggle additional details"
            tooltip-placement="bottom")
      | Info
    .dropdown-btn
      button.cfnext-btn-secondary-action(cf-dropdown-toggle="entryEditor.view")
        cf-icon.btn-dropdown-icon(name="dd-arrow-down")
        | View
      .context-menu(cf-dropdown-menu="entryEditor.view" cf-dropdown-position="bottomcenter")
        cf-icon.context-menu__arrow(name="arrow-up")
        ul.context-menu__items.lang-switcher(ng-show="showLangSwitcher")
          li(ng-repeat="locale in spaceContext.privateLocales track by locale.sys.id")
            label
              input(type="checkbox" ng-model="spaceContext.localeStates[locale.code]")
              | {{locale.name}}
              span(ng-show="locale == spaceContext.space.getDefaultLocale()") (default)
        .context-menu__item
          label
            input(type="checkbox" ng-model="preferences.showDisabledFields")
            | Show disabled fields

.aux-panel(ng-show="preferences.showAuxPanel")
  header
    h1 Entry Information
  .entity-info-panel(cf-entity-info-panel="otDoc.snapshot.sys")

.tab-main.tab-workbench
  form.l-form(name="entryForm")
    .l-form-row--no-label(ng-show="hasErrorOnFields")
      .l-form-controls
        cf-error-list.form-box-error(cf-error-path="['fields']")
    cf-form-widget.l-form-row(ng-repeat="widget in widgets track by widget.id"
        data-field-id="{{field.id}}"
        data-field-api-name="{{field.apiName}}"
        data-field-type="{{field.type}}"
        data-field-items-type="{{field.items.type}}"
        ng-class="{'data-field-array': (field|isFieldLink), 'data-field-boolean': (field|isFieldBoolean), 'data-field-string-list': (field|isFieldStringList)}")
      label(ng-if="field")
        | {{field.name}} 
        sup(ng-show="field.required") (required)
      .l-form-controls(ng-if="field")
        .l-form-locale(ng-repeat="locale in locales track by locale.code"
            ot-field-presence="['fields', field.id, locale.code]"
            data-locale="{{locale.code}}")
          cf-widget-renderer.l-field-editor(
            cf-focus-ot-input="shouldFocusField()"
            ot-path="['fields', field.id, locale.code]"
            cf-field-editor="entry.data.fields[field.id][locale.code]")
          .locale-label(ng-show="locales.length > 1") {{locale.name}}
          .field-collaborators
            ul.field-list
              li.avatar(cf-user ng-repeat="link in fieldPresence.users track by link.sys.id"
                                 link="link" as="presenceUser"
                                 tooltip="{{presenceUser | userNameDisplay:user}}")
                img(ng-src="{{presenceUser.avatarUrl}}")
          cf-error-list.form-box-error(cf-error-path="['fields', field.id, locale.code,'*']")
        .form-widget__help-text(ng-if="showHelpText") {{helpText}}
        cf-error-list.form-box-error(cf-error-path="['fields', field.id]")
      .l-form-controls(ng-if="!field")
        cf-widget-renderer

.tab-actions(ng-controller="EntryActionsController")
  .button-set
    .dropdown-btn(ng-show="entityActionsController.canDelete() || entityActionsController.canDuplicate()")
      button.cfnext-btn-secondary-action(cf-dropdown-toggle="entryEditor.moreActions")
        cf-icon.btn-dropdown-icon--up(name="dd-arrow-down")
        | More
      .context-menu(
        cf-dropdown-menu="entryEditor.moreActions"
        cf-dropdown-position="top")
        ul
          li.context-menu__item.duplicate(
            ng-show="entityActionsController.canDuplicate()"
            ng-click="duplicate()"
            cf-dropdown-close)
            | Duplicate
          li.context-menu__item.delete(
            ng-show="entityActionsController.canDelete()"
            cf-dropdown-toggle="entryEditor.delete")
            | Delete
          .delete-confirm.no-caret(
            cf-dropdown-menu="entryEditor.delete"
            cf-dropdown-position="topcenter")
            p You are about to delete {{headline()}}
            button.cfnext-btn-caution(type="button" ng-click="delete()" cf-dropdown-close) Delete 
            button.cfnext-btn-secondary-action(type="button" cf-dropdown-close) Don't Delete 

    | 
    button.cfnext-btn-secondary-action.archive(type="button" ng-show="entityActionsController.canArchive()"   ng-click="archive()"   tooltip="Archive this Entry") Archive
    | 
    button.cfnext-btn-secondary-action.archive(type="button" ng-show="entityActionsController.canUnarchive()" ng-click="unarchive()" tooltip="Unarchive this Entry") Unarchive
    | 

    .dropdown-btn(ng-show="entityActionsController.canUpdate() && (canRevertToPublishedState() || canRevertToPreviousState())")
      button.cfnext-btn-secondary-action(cf-dropdown-toggle="entryEditor.revertActions")
        cf-icon.btn-dropdown-icon--up(name="dd-arrow-down")
        | Revert
      .context-menu.revert-actions__menu(
        cf-dropdown-menu="entryEditor.revertActions"
        position="topcenter")
        cf-icon.context-menu__arrow.x--bottom(name="arrow-up")
        ul.context-menu__items
          li(type="button" ng-show="canRevertToPublishedState()" ng-click="revertToPublishedState()" cf-dropdown-close) Revert to published version ({{publishedAt}})
          li(type="button" ng-show="canRevertToPreviousState()" ng-click="revertToPreviousState()" cf-dropdown-close) Discard my changes ({{updatedAt}})

    button.cfnext-btn-secondary-action.unpublish(type="button" ng-show="entityActionsController.canUnpublish()" ng-click="unpublish()" tooltip="Unpublish this Entry") Unpublish
    | 
    button.cfnext-btn-primary-action.publish(type="submit" ng-show="entityActionsController.canPublish()" ng-click="publish()" tooltip="{{publishButtonLabel()}} this Entry") {{publishButtonLabel()}}
  .save-status(cf-save-status tooltip="Every change you make is automatically saved as a draft. Hit {{publishButtonLabel()}} to distribute your changes."
               tooltip-placement="top")
  .other-users
    span(ng-show="presence.users.length == 0"
          tooltip="Edit collaboratively by inviting more users into your space. Go to Settings → Users → Invite New User to invite people.")
      | No other users online
    ul(ng-show="presence.users.length > 0")
      li.avatar(cf-user ng-repeat="link in presence.users track by link.sys.id"
                         link="link" as="presenceUser"
                         tooltip="{{presenceUser | userNameDisplay:user}}")
        img(ng-src="{{presenceUser.data.avatarUrl}}")
    a.cfnext-btn-secondary-action.invite-users(
      ui-sref="spaces.detail.settings.pathSuffix({ pathSuffix: '/users/new' })"
      tooltip="Add a user to this space")
      i.fa.fa-user
      i.fa.fa-plus
