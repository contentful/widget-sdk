include ../advice.mixin.jade
include ../pluralize_entity.mixin.jade

header.workbench-header
  cf-breadcrumbs
  .workbench-header__left
    cf-icon.workbench-header__icon(name="page-media")
    h1.workbench-header__title
      | Media
      cf-knowledge-base.workbench-headr__kb-link(target="asset")

  .workbench-header__search.search-area(
    ng-hide="showNoAssetsAdvice()")
    .search-area__input(
      cf-tokenized-search="context.view.searchTerm"
      search-content-type="assetContentType"
      placeholder="Type to search. Press the down arrow key for help.")

    .search-results-position(cf-search-results-position paginator="searchController.paginator" ng-hide="!searchController.paginator.getTotal()")

  .workbench-header__actions(
    ng-show="!showNoAssetsAdvice() && !shouldHide('createAsset')")
    button.btn-action(
      cf-context-menu-trigger
      ng-disabled="shouldDisable('createAsset')"
      cf-when-disabled="createAsset"
      data-test-id="add-asset-menu-trigger")
      cf-icon.btn-icon.inverted(name="plus")
      cf-icon.btn-dropdown-icon(name="dd-arrow-down")
      | Add asset
    .context-menu(
      role="menu" cf-context-menu
      aria-label="Add Assets" data-test-id="add-asset-menu")
      ul.context-menu__items
        li(role="menuitem" ng-click="entityCreationController.newAsset()")
          | Single asset
        li(role="menuitem" ng-click="createMultipleAssets()" ng-show="canUploadMultipleAssets()")
          | Multiple assets

.workbench-main(ng-hide="showNoAssetsAdvice()")
  .workbench-main__left-sidebar(
    ng-show="uiConfig"
    cf-view-menu="uiConfig.assetListViews")

  .workbench-main__right-content
    .search-results__count(ng-show="searchController.paginator.getTotal() > 0")
      +pluralize-entity("asset", "searchController.paginator.getTotal()", "found")
    .table(ng-show="assets.length && !isEmpty")
      .table__head
        table
          thead
            tr
              th(aria-label="cell-preview").x--image-cell
                label(ng-click="$event.stopPropagation()")
                  input(type="checkbox" cf-selection="assets" ng-click="selection.toggleList(assets, $event)" ng-show="assets.length > 0" tabindex="-1")
                | Preview
              th(aria-label="cell-name").x--large-cell Name
              th(aria-label="cell-dimensions").x--medium-cell Dimensions
              th(aria-label="cell-type") Type
              th(aria-label="cell-updated") Updated
              th(aria-label="cell-author").x--small-cell By
              th(aria-label="cell-status").x--small-cell Status

      .table__bulk-actions(ng-hide="selection.isEmpty()")
        .workbench-actions(ng-controller="AssetListActionsController")
          .workbench-actions__label
            +pluralize-entity("asset", "selection.size()", "selected: ")

          span(ng-show="!showArchive() && !showUnarchive() && !showDelete() && !showPublish() && !showUnpublish()")
            | No actions possible
          span.text-link--neutral-emphasis-mid(type="button"
            ng-click="archiveSelected()"
            ng-show="showArchive()"
            aria-label="archive")
            | Archive
          span.text-link--neutral-emphasis-mid(type="button"
            ng-click="unarchiveSelected()"
            ng-show="showUnarchive()"
            aria-label="unarchive")
            | Unarchive
          span.text-link--destructive(
            type="button"
            ng-show="showDelete()"
            cf-context-menu-trigger
            data-test-id="delete-asset"
            aria-label="delete")
            | Delete
          .delete-confirm(cf-context-menu="bottom")
            p You are about to delete #[+pluralize-entity("asset", "selection.size()")]
            button.btn-caution(type="button" ng-click="deleteSelected()") Delete
            button.btn-secondary-action(type="button") Don't Delete
          span.text-link--constructive(type="submit"
            ng-click="publishSelected()"
            ng-show="showPublish()"
            aria-label="publish")
            | {{publishButtonName()}}
          span.text-link--neutral-emphasis-mid(type="button"
            ng-click="unpublishSelected()"
            ng-show="showUnpublish()"
            aria-label="unpublish")
            | Unpublish

      .table__body
        table
          tbody
            tr(ng-repeat="asset in assets track by asset.getId()"
                ng-init="file=spaceContext.localizedField(asset, 'data.fields.file')"
                ui-sref="spaces.detail.assets.detail({ assetId: asset.getId() })"
                ng-class="{'x--highlight': selection.isSelected(asset)}")
              td(aria-label="cell-preview").x--image-cell
                div
                  label(ng-click="$event.stopPropagation()")
                    input(type="checkbox" cf-selection="asset" tabindex="-1" ng-click="selection.toggle(asset, $event)")
                  cf-thumbnail(file="file" size="30" ng-if="file")
              td(aria-label="cell-name").x--large-cell {{ spaceContext.assetTitle(asset) }}
              td(aria-label="cell-dimensions").x--medium-cell
                span(ng-bind-html="getAssetDimensions(asset)")
              td(aria-label="cell-type")
                span {{file|fileType}}
                span.extension {{file|fileExtension}}
              td(aria-label="cell-updated")
                date(ng-if="asset.getUpdatedAt()" datetime="{{asset.getUpdatedAt()}}" cf-relative-datetime)
              td.x--small-cell(aria-label="cell-author")
                span(cf-user link="asset.getUpdatedBy()" as="updater")
                  | {{updater | userNameDisplay:user}}
              td.entity-status.x--small-cell(
                aria-label="cell-status"
                ng-class="entityStatus.getClassname(asset)")
                | {{entityStatus.getLabel(asset)}}

    cf-search-results-paginator(paginator="searchController.paginator" pages="7")

    +no-search-results("!assets.length || isEmpty", "context.view.searchTerm")

.workbench-main.x--content(ng-show="showNoAssetsAdvice()")
  include ./no_assets_advice
