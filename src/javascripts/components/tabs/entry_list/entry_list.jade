include ./create_entry_button.mixin.jade
include ../advice.mixin.jade

header.workbench-header
  cf-breadcrumbs
  .workbench-header__left
    cf-icon.workbench-header__icon(name="page-entries")
    h1.workbench-header__title
      | Content
      cf-knowledge-base.workbench-header__kb-link(target="entry")

  .workbench-header__search.search-area--with-filter(
    ng-show="!showNoEntriesAdvice()")
    select.search-area__select-box.cfnext-select-box(
      ng-model="context.view.contentTypeId"
      ng-change="selectedContentType()"
      ng-options="ct.id as ct.name group by 'Content types' for ct in contentTypeSelectOptions")
      option(value="") All

    .search-area__input(
      cf-tokenized-search="context.view.searchTerm"
      search-content-type="getSearchContentType()"
      placeholder="Type to search. Press the down arrow key for help."
      cf-on-blur-component="leftSearch($event)"
      cf-on-blur-component-when="showAutocompletions")

    .search-results-position(cf-search-results-position paginator="paginator" ng-hide="!paginator.getTotal()")

  .workbench-header__actions(ng-if="!showNoEntriesAdvice()")
    +create-entry-button

.workbench-main(ng-hide="showNoEntriesAdvice()")
  .workbench-main__left-sidebar(
    ng-show="uiConfig"
    cf-view-menu="uiConfig.entryListViews")

  .workbench-main__right-content
    .view-customizer(cf-view-customizer)
    .table
      .table__head
        table
          thead
            tr
              th.x--checkbox-cell
                input(type="checkbox" cf-selection="entries" ng-show="entries.length > 0" tabindex="-1")
              th.x--large-cell(ng-if="!context.view.contentTypeId || !displayFieldForFilteredContentType()") Name
              th.x--medium-cell(ng-show="!context.view.contentTypeId && !context.view.contentTypeHidden") Content type
              th.x--small-cell(ng-if="context.view.contentTypeId && displayFieldForFilteredContentType()"
                ng-init="field=displayFieldForFilteredContentType()"
                ng-class="{'x--sortable': fieldIsSortable(field), 'x--active-sort': isOrderField(field)}")
                span(ng-if="isDisplayField"
                  ng-click="fieldIsSortable(field) && orderColumnBy(field)")
                  | Name
                  span(ng-show="fieldIsSortable(field)")
                    i.fa.fa-caret-up(ng-show="context.view.order.direction == 'ascending' && isOrderField(field)")
                    i.fa.fa-caret-down(ng-show="context.view.order.direction == 'descending' && isOrderField(field)")
              th.x--small-cell(ng-repeat="field in displayedFields track by field.id"
                ng-class="{'x--sortable': fieldIsSortable(field), 'x--active-sort': isOrderField(field)}"
                data-field-id="{{field.id}}"
                ng-click="fieldIsSortable(field) && orderColumnBy(field)")
                | {{field.name}}
                span(ng-show="fieldIsSortable(field)")
                  i.fa.fa-caret-up(ng-show="context.view.order.direction == 'ascending' && isOrderField(field)")
                  i.fa.fa-caret-down(ng-show="context.view.order.direction == 'descending' && isOrderField(field)")
              th.x--small-cell Status

      .table__bulk-actions
        .workbench-actions(
          ng-hide="selection.isEmpty()"
          ng-controller="EntryListActionsController")
          .workbench-actions__label
            | {{selection.size()}} Entries selected

          button.btn-secondary-action.duplicate(type="button"
            ng-click="duplicateSelected()"
            ng-show="showDuplicate()")
            | Duplicate
          button.btn-secondary-action.delete(type="button"
            ng-show="showDelete()"
            cf-context-menu-trigger
            data-test-id="delete-entry")
            | Delete
          .delete-confirm(cf-context-menu="top")
            p You are about to delete {{selection.size()}} Entries
            button.btn-caution(type="button" ng-click="deleteSelected()")
              | Delete
            button.btn-secondary-action(type="button")
              | Don't Delete
          button.btn-secondary-action.archive(  type="button" ng-click="archiveSelected()"   ng-show="showArchive()"  ) Archive
          button.btn-secondary-action.unarchive(type="button" ng-click="unarchiveSelected()" ng-show="showUnarchive()") Unarchive
          button.btn-secondary-action.unpublish(type="button" ng-click="unpublishSelected()" ng-show="showUnpublish()") Unpublish
          button.btn-primary-action.publish(    type="submit" ng-click="publishSelected()"   ng-show="showPublish()"  ) {{publishButtonName()}}

      .table__body.main-results-wrapper.endless-container(cf-endless-container at-bottom="loadNextPage()" num-elements="paginator.getPage()")
        table
          tbody
            tr.x--multiline(ng-repeat="entry in entries track by entry.getId()"
              ng-init="entityNavState='spaces.detail.entries.detail({ entryId: entry.getId() })'"
              ui-sref="{{entityNavState}}"
              ng-class="{'x--highlight': isSelected(entry)}")
              td.x--checkbox-cell(ng-click="selection.toggle(entry);$event.stopPropagation()")
                input(type="checkbox" cf-selection="entry" tabindex="-1")
              td.x--large-cell
                p {{entryTitle(entry)}}
              td.x--medium-cell(ng-show="!context.view.contentTypeId && !context.view.contentTypeHidden")
                | {{contentTypeName(entry)}}
              td.x--small-cell(ng-repeat="field in displayedFields track by field.id")
                cf-field-display
              td.entity-status.x--small-cell(ng-class="entityStatus.getClassname(entry)")
                | {{entityStatus.getLabel(entry)}}
        .loading(ng-hide="paginator.isAtLast()")
    +no-search-results("!entries.length || isEmpty", "context.view.searchTerm")

.workbench-main.x--content(ng-show="showNoEntriesAdvice()")
  include ./no_entries_advice
